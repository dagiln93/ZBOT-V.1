<!DOCTYPE html>
<html lang="{{ current_lang }}" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t.history }} - {{ t.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --border-color: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1e1b4b 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            padding: 2rem 1rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        .table {
            color: var(--text-primary);
        }
        
        .table th {
            border-color: var(--border-color);
            color: var(--text-secondary);
        }
        
        .table td {
            border-color: var(--border-color);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 8px;
        }
        
        .pagination .page-link {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        
        .pagination .page-item.active .page-link {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .filters-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        .form-control, .form-select {
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .form-control:focus, .form-select:focus {
            background: var(--dark-bg);
            border-color: var(--primary-color);
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-history me-2"></i>{{ t.history }}</h1>
            <p class="text-muted">{{ t.history }} - {{ t.title }}</p>
        </div>

        <!-- Filters -->
        <div class="filters-card">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">{{ t.symbol }}</label>
                    <input type="text" class="form-control" name="symbol" value="{{ symbol }}" placeholder="BTC">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Days</label>
                    <select class="form-select" name="days">
                        <option value="7" {{ 'selected' if days == 7 }}>7 days</option>
                        <option value="30" {{ 'selected' if days == 30 }}>30 days</option>
                        <option value="90" {{ 'selected' if days == 90 }}>90 days</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Per Page</label>
                    <select class="form-select" name="per_page">
                        <option value="10" {{ 'selected' if per_page == 10 }}>10</option>
                        <option value="20" {{ 'selected' if per_page == 20 }}>20</option>
                        <option value="50" {{ 'selected' if per_page == 50 }}>50</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Results -->
        {% if history %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    {% if symbol %}
                        {{ t.history }} for {{ symbol.upper() }}
                    {% else %}
                        {{ t.history }}
                    {% endif %}
                    ({{ total_count }} signals)
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>{{ t.symbol }}</th>
                                <th>{{ t.signal }}</th>
                                <th>{{ t.price }}</th>
                                <th>{{ t.strength }}</th>
                                <th>{{ t.precision }}</th>
                                <th>{{ t.status }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for signal in history %}
                            <tr>
                                <td>{{ signal.signal_time[:10] }}</td>
                                <td><strong>{{ signal.symbol }}</strong></td>
                                <td>
                                    {% if signal.direction == 'long' %}
                                        <span class="text-success">
                                            <i class="fas fa-arrow-up"></i> {{ t.long }}
                                        </span>
                                    {% else %}
                                        <span class="text-danger">
                                            <i class="fas fa-arrow-down"></i> {{ t.short }}
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="font-monospace">{{ signal.price }}</td>
                                <td>{{ "%.2f"|format(signal.strength) }}</td>
                                <td>
                                    {% set precision_pct = (signal.precision * 100)|round(1) %}
                                    <span class="{% if precision_pct >= 70 %}text-success{% elif precision_pct >= 50 %}text-warning{% else %}text-danger{% endif %}">
                                        {{ precision_pct }}%
                                    </span>
                                </td>
                                <td>
                                    {% if signal.is_valid %}
                                        <span class="text-success">
                                            <i class="fas fa-check-circle"></i> {{ t.active }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">
                                            <i class="fas fa-clock"></i> {{ t.expired }}
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        {% if total_count > per_page %}
        <nav aria-label="History pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                {% set total_pages = (total_count + per_page - 1) // per_page %}
                
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page - 1 }}&symbol={{ symbol }}&days={{ days }}&per_page={{ per_page }}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                {% endif %}
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <li class="page-item active">
                        <span class="page-link">{{ p }}</span>
                    </li>
                    {% elif p <= page + 2 and p >= page - 2 %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ p }}&symbol={{ symbol }}&days={{ days }}&per_page={{ per_page }}">{{ p }}</a>
                    </li>
                    {% endif %}
                {% endfor %}
                
                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page + 1 }}&symbol={{ symbol }}&days={{ days }}&per_page={{ per_page }}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <!-- No Results -->
        <div class="text-center py-5">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-history fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No history found</h5>
                    <p class="text-muted">Try adjusting your filters or search for a different symbol.</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Back Button -->
        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>Back to Analysis
            </a>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 